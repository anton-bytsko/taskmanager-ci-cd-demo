name: Run Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Create directories
      run: |
        mkdir -p build/classes build/test-classes lib
    
    - name: Download JUnit
      run: |
        wget -O lib/junit.jar https://repo1.maven.org/maven2/junit/junit/4.13.2/junit-4.13.2.jar
        wget -O lib/hamcrest.jar https://repo1.maven.org/maven2/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar
    
    - name: Compile main classes
      run: |
        javac -d build/classes \
              -sourcepath src/main/java \
              src/main/java/com/taskmanager/*.java
    
    - name: Compile test classes
      run: |
        javac -d build/test-classes \
              -cp "build/classes:lib/junit.jar:lib/hamcrest.jar" \
              -sourcepath src/test/java \
              src/test/java/com/taskmanager/*.java
    
    - name: Run tests
      run: |
        echo "Running TaskTest..."
        java -cp "build/classes:build/test-classes:lib/junit.jar:lib/hamcrest.jar" \
             org.junit.runner.JUnitCore \
             com.taskmanager.TaskTest
        
        echo "Running TaskManagerTest..."
        java -cp "build/classes:build/test-classes:lib/junit.jar:lib/hamcrest.jar" \
             org.junit.runner.JUnitCore \
             com.taskmanager.TaskManagerTest
    
    - name: Test results summary
      if: always()
      run: |
        echo "========================================"
        echo "âœ… AUTOMATED TESTING COMPLETED"
        echo "========================================"
        echo "Tests executed:"
        echo "- TaskTest: 3 tests"
        echo "- TaskManagerTest: 7 tests"
        echo "Total: 10 tests"
        echo "========================================"